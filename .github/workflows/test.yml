name: CI/CD Pipeline

on:
 push:
   branches: [ main ]
 pull_request:
   branches: [ main ]

env:
 DB_USER: ${{ vars.DB_USER }}
 DB_PASS: ${{ secrets.DB_PASS }}
 DB_NAME: ${{ vars.DB_NAME }}

jobs:
 test:
   runs-on: ubuntu-latest
   steps:
     - uses: actions/checkout@v3
     
     - name: Setup Node.js
       uses: actions/setup-node@v3
       with:
         node-version: '18'
         cache: 'npm'

     - name: Install dependencies  
       run: npm ci

     - name: Start database
       run: npm run db:up
       env:
         DB_USER: ${{ vars.DB_USER }}
         DB_PASS: ${{ secrets.DB_PASS }}
         DB_NAME: ${{ vars.DB_NAME }}